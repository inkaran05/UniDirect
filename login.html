<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Signup - UniDirect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-2xl shadow-xl">
        <!-- Logo and Title -->
        <div class="text-center">
            <a href="/" class="flex items-center justify-center space-x-3 mb-4">
                <svg class="h-10 w-10 text-blue-600" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.25L2 7.5L12 12.75L22 7.5L12 2.25Z"/><path d="M2 16.5L12 21.75L22 16.5V11.25L12 16.5L2 11.25V16.5Z" fill-opacity="0.5"/><path d="M20 12.375V8.25L12 12.75L4 8.25V12.375L12 17.25L20 12.375Z" /></svg>
                <span class="text-3xl font-bold text-blue-600">UniDirect</span>
            </a>
            <h2 id="form-title" class="text-2xl font-bold text-gray-800">Welcome Back</h2>
            <p id="form-subtitle" class="text-gray-600">Please enter your details to log in.</p>
        </div>

        <!-- Tab Switcher -->
        <div class="grid grid-cols-2 gap-2 p-1 bg-gray-200 rounded-lg">
            <button id="login-tab" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-md shadow">Login</button>
            <button id="signup-tab" class="px-4 py-2 text-sm font-semibold text-gray-700">Sign Up</button>
        </div>
        
        <!-- Error Message Display -->
        <div id="error-message" class="hidden p-3 text-sm text-red-700 bg-red-100 rounded-lg"></div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-4">
            <div>
                <label for="login-email" class="text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="login-email" required class="w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com">
            </div>
            <div>
                <label for="login-password" class="text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="login-password" required class="w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="••••••••">
            </div>
            <button type="submit" class="w-full py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">Login</button>
        </form>

        <!-- Signup Form -->
        <form id="signup-form" class="hidden space-y-4">
            <div>
                <label for="signup-name" class="text-sm font-medium text-gray-700">Full Name</label>
                <input type="text" id="signup-name" required class="w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="John Doe">
            </div>
            <div>
                <label for="signup-email" class="text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="signup-email" required class="w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com">
            </div>
            <div>
                <label for="signup-password" class="text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="signup-password" required class="w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Minimum 6 characters">
            </div>
            <button type="submit" class="w-full py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">Create Account</button>
        </form>

        <!-- Divider -->
        <div class="flex items-center justify-center">
            <div class="w-full h-px bg-gray-300"></div>
            <div class="px-4 text-sm font-semibold text-gray-500">OR</div>
            <div class="w-full h-px bg-gray-300"></div>
        </div>

        <!-- Google Sign-in Button -->
        <button id="google-signin" class="w-full flex items-center justify-center py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            <img class="w-6 h-6 mr-3" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
            <span class="font-semibold text-gray-700">Sign in with Google</span>
        </button>
    </div>

    <script type="module">
        // IMPORTANT: Replace with your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "unidirect-f4687.firebaseapp.com",
            projectId: "unidirect-f4687",
            storageBucket: "unidirect-f4687.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            GoogleAuthProvider,
            signInWithPopup,
            onAuthStateChanged,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // --- DOM Elements ---
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const googleSigninBtn = document.getElementById('google-signin');
        const errorMessageDiv = document.getElementById('error-message');
        const formTitle = document.getElementById('form-title');
        const formSubtitle = document.getElementById('form-subtitle');

        // --- Functions ---
        function showMessage(message, isError = true) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.className = isError 
                ? 'p-3 text-sm text-red-700 bg-red-100 rounded-lg' 
                : 'p-3 text-sm text-green-700 bg-green-100 rounded-lg';
            errorMessageDiv.classList.remove('hidden');
        }

        function hideMessage() {
            errorMessageDiv.classList.add('hidden');
        }

        function handleAuthSuccess(user) {
            console.log('Authentication successful for:', user.displayName || user.email);
            showMessage(`Welcome, ${user.displayName || user.email}! Redirecting...`, false);
            // Redirect to dashboard or home page after a short delay
            setTimeout(() => {
                window.location.href = '/dashboard.html'; // Or your main page
            }, 2000);
        }

        // --- Event Listeners ---
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('bg-blue-600', 'text-white', 'shadow');
            loginTab.classList.remove('text-gray-700');
            signupTab.classList.remove('bg-blue-600', 'text-white', 'shadow');
            signupTab.classList.add('text-gray-700');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            formTitle.textContent = 'Welcome Back';
            formSubtitle.textContent = 'Please enter your details to log in.';
            hideMessage();
        });

        signupTab.addEventListener('click', () => {
            signupTab.classList.add('bg-blue-600', 'text-white', 'shadow');
            signupTab.classList.remove('text-gray-700');
            loginTab.classList.remove('bg-blue-600', 'text-white', 'shadow');
            loginTab.classList.add('text-gray-700');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            formTitle.textContent = 'Create an Account';
            formSubtitle.textContent = 'Join UniDirect to find your dream college.';
            hideMessage();
        });

        // Handle Email/Password Signup
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                // Update profile with the name
                await updateProfile(userCredential.user, { displayName: name });
                console.log('Signup successful, user created:', userCredential.user);
                // The onAuthStateChanged listener will handle the success redirect
            } catch (error) {
                console.error("Signup Error:", error.message);
                showMessage(error.message);
            }
        });

        // Handle Email/Password Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('Login successful:', userCredential.user);
                 // The onAuthStateChanged listener will handle the success redirect
            } catch (error) {
                console.error("Login Error:", error.message);
                showMessage("Invalid email or password. Please try again.");
            }
        });

        // Handle Google Sign-in
        googleSigninBtn.addEventListener('click', async () => {
            hideMessage();
            try {
                const result = await signInWithPopup(auth, googleProvider);
                console.log('Google Sign-in successful:', result.user);
                 // The onAuthStateChanged listener will handle the success redirect
            } catch (error) {
                console.error("Google Sign-in Error:", error.message);
                showMessage(error.message);
            }
        });

        // --- Auth State Observer ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in.
                // This is the central place to handle a successful login/signup.
                handleAuthSuccess(user);
            } else {
                // User is signed out.
                console.log('No user is signed in.');
            }
        });

    </script>
</body>
</html>
